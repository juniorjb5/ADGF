---
title: "04-dplyr"
author: "Silvia P. Canelón"
date: "9/19/2020"
output: html_document
---

class: penguin-tour

```{r, echo=FALSE, out.width=1200}
knitr::include_graphics("images/pptx/04-dplyr.png")
```



---
background-image: url(images/hex/dplyr.png)
background-position: 1050px 50px
background-size: 80px

# dplyr: información

.panelset[
.panel[.panel-name[Resumen general]

.pull-left[
### La transformación de datos te ayuda a poner los datos exactamente en la forma que necesitas. <br/> Con `dplyr` puedes:

- crear nuevas variables
- crear resúmenes
- renombrar variables
- reordenar observaciones
- ¡...y más!
]
.pull-right[
- Seleccionar observaciones según sus valores con `filter()`.
- Reordenar las filas con `arrange()`.
- Seleccionar variables por su nombre con `select()`.
- Crear nuevas variables como funciones de variables existentes con `mutate()`.
- Reducir muchos valores a un solo resumen con `summarize()`.
- `group_by()` hace que las funciones anteriores operen por grupos en lugar de hacerlo sobre todo el dataset. 
- y `count()` + `add_count()` simplifican `group_by()` + `summarize()` cuando solo quieres contar
]
]

.panel[.panel-name[Hoja de referencia]

`r icon::fa("file-pdf")` PDF: https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf
![](https://raw.githubusercontent.com/rstudio/cheatsheets/master/pngs/thumbnails/data-transformation-cheatsheet-thumbs.png)
]

.panel[.panel-name[Lectura]

.left-column[
```{r echo=FALSE}
knitr::include_graphics("images/r4ds-cover.png")
```
]

.right-column[
### R for Data Science: [Cap. 11 Transformación de datos](https://r4ds.had.co.nz/transform.html)

### Documentación del paquete: https://dplyr.tidyverse.org/
]
]
]

---
background-image: url(images/hex/dplyr.png)
background-position: 1050px 50px
background-size: 80px

# dplyr: ejercicio

.panelset[

.panel[.panel-name[Select]
.center[ 
### ¿Puedes identificar la diferencia al hacer la misma operación?
]
.pull-left[
```{r}
select(penguins, species, sex, body_mass_g)
```
]

.pull-right[
```{r}
penguins %>%
  select(species, sex, body_mass_g)
```
]
]

.panel[.panel-name[Arrange]

Podemos usar `arrange()` para ordenar nuestros datos en orden descendente según **body_mass_g**

.pull-left[
```{r}
glimpse(penguins)
```
]
.pull-right[
```{r}
penguins %>%
  select(species, sex, body_mass_g) %>%
  arrange(desc(body_mass_g)) #<<
```
]
]


.panel[.panel-name[Group By & Summarize]

.pull-left[
.middle[Podemos usar `group_by()` para agrupar nuestros datos por **species** y **sex**, y `summarize()` para calcular el promedio de **body_mass_g** para cada grupo.]
]

.pull-right[
```{r}
penguins %>%
  select(species, sex, body_mass_g) %>%
  group_by(species, sex) %>%          #<<
  summarize(mean = mean(body_mass_g)) #<<
```
]
]


.panel[.panel-name[Counting 1]
Si solo nos interesa _contar_ las observaciones en cada grupo, podemos agrupar y resumir con funciones especiales `count()` y `add_count()`.

----

.pull-left[
Contar se puede hacer con `group_by()` y `summarize()`, pero es un poco engorroso. 

Implica...
1. usar `mutate()` para crear una variable intermedia **n_species** que suma todas las observaciones por **species**, y
2. un paso de `ungroup()`
]

.pull-right[
```{r}
penguins %>% 
  group_by(species) %>%
  mutate(n_species = n()) %>%            #<<
  ungroup() %>%                          #<<
  group_by(species, sex, n_species) %>%
  summarize(n = n())
```
]
]

.panel[.panel-name[Counting 2]
Si solo nos interesa _contar_ las observaciones en cada grupo, podemos agrupar y resumir con funciones especiales `count()` y `add_count()`.

----

.pull-left[
En contraste, `count()` y `add_count()` ofrecen un enfoque simplificado


]
.pull-right[
```{r}
penguins %>% 
  count(species, sex) %>%
  add_count(species, wt = n,    #<<
            name = "n_species") #<<
```
]
]

.panel[.panel-name[Mutate]

.pull-left[
Podemos ampliar nuestro ejemplo de conteo usando `mutate()` para crear una nueva variable **prop**, que representa la proporción de pingüinos de cada **sex**, agrupado por **species**

.small-text[Ejemplo amablemente [aportado por Alison Hill (@apreshill)](https://github.com/spcanelon/2020-rladies-chi-tidyverse/issues/2)]
]
.pull-right[
```{r}
penguins %>% 
  count(species, sex) %>%
  add_count(species, wt = n, 
            name = "n_species") %>%
  mutate(prop = n/n_species*100)     #<<
```
]
]

.panel[.panel-name[Filter]

.pull-left[
Por último, podemos filtrar filas para mostrar únicamente los resúmenes de pingüinos **Chinstrap** agregando `filter()` a nuestro pipeline]

.pull-right[
```{r}
penguins %>% 
  count(species, sex) %>%
  add_count(species, wt = n, 
            name = "n_species") %>%
  mutate(prop = n/n_species*100) %>%
  filter(species == "Chinstrap") #<<
```
]
]

]

